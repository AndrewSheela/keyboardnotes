<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Updated Title to reflect the overall quiz topic -->
    <title>Major Scale Construction Quiz</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configure Tailwind for Inter font and custom colors -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary': '#4f46e5',
                        'secondary': '#10b981',
                        'success': '#10b981', /* Green */
                        'danger': '#ef4444', /* Red */
                        'dark-bg': '#1f2937',
                        'card-bg': '#374151',
                        'selected-bg': '#fde047', /* Yellow */
                        'selected-text': '#1f2937',
                    }
                }
            }
        }
    </script>
    <style>
        /* General styling for a dark, engaging theme, optimized for mobile */
        body {
            background-color: #0d1117;
            color: #e5e7eb;
            font-family: 'Inter', sans-serif;
        }

        /* Styling for the note buttons with a subtle 3D press effect */
        .note-button {
            transition: all 0.1s;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2), 0 2px 4px -1px rgba(0, 0, 0, 0.1);
        }

        .note-button:active {
            transform: translateY(2px);
            box-shadow: none;
        }

        /* Ensure the main container is centered and uses the full viewport width responsively */
        #quiz-container {
            min-height: 100vh;
        }
        
        /* Flex basis ensures a proper wrap on smaller screens */
        .note-option-row {
            display: flex;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>

    <div id="quiz-container" class="max-w-4xl mx-auto p-4 flex flex-col items-center">

        <!-- Header -->
        <header class="w-full text-center py-6 bg-dark-bg rounded-b-xl shadow-lg border-b-4 border-primary">
            <h1 class="text-4xl font-extrabold text-white tracking-tight sm:text-5xl">Major Scale Construction Challenge</h1>
            <p class="mt-2 text-xl font-medium text-secondary">
                Major Scale Formula:
                <br>
                <!-- Major Scale Formula (Whole/Half Steps) -->
                <span class="text-3xl font-extrabold tracking-widest block mt-1 select-none">W W H W W W H</span>
            </p>
            <p class="text-sm text-gray-400 select-none">(W - Whole Step &nbsp; H - Half Step)</p>
        </header>

        <!-- Quiz Area -->
        <main class="w-full mt-8 p-4 md:p-8 bg-card-bg rounded-xl shadow-2xl">
            
            <!-- Removed Level Selection Buttons -->


            <!-- Current Key Display & Question Index & Score -->
            <div class="flex flex-col md:flex-row justify-between items-center mb-6 border-b border-gray-600 pb-4 select-none">
                <div class="text-lg font-semibold text-gray-300">
                    Question <span id="current-question-index">1</span> of 10
                </div>
                <h2 class="text-3xl font-bold text-yellow-300 my-2 md:my-0">
                    Key: <span id="current-key">C</span> Major
                </h2>
                <!-- New Score Display -->
                <div class="text-xl font-bold text-secondary">
                    Score: <span id="current-score">0</span> / 80
                </div>
            </div>

            <!-- Note Input Slots (8 boxes for the scale) -->
            <div id="input-slots" class="grid grid-cols-4 md:grid-cols-8 gap-3 md:gap-4 mb-8">
                <!-- Slots will be injected here -->
            </div>

            <!-- Action Buttons -->
            <div id="action-buttons-container" class="flex justify-center space-x-4 mb-8">
                <button id="clear-button" class="px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg note-button transition duration-150 ease-in-out disabled:opacity-50" disabled>
                    Clear Last
                </button>
                <button id="submit-button" class="px-8 py-3 bg-primary hover:bg-indigo-600 text-white font-bold rounded-lg note-button transition duration-150 ease-in-out disabled:opacity-50">
                    Submit
                </button>
            </div>
            
            <!-- Status/Auto-advance Message -->
            <div id="status-message" class="hidden text-center mt-4 mb-8 p-3 rounded-lg border">
                <p class="text-xl font-medium"></p>
            </div>


            <!-- Note Options -->
            <div class="note-options-container p-3 border border-gray-600 rounded-xl">
                <h3 class="text-md font-semibold mb-2 text-gray-300">Available Notes (Click to select):</h3>
                <div id="note-options">
                    <!-- Note buttons will be injected here by JS -->
                </div>
            </div>
            
            <!-- Quiz End Message -->
            <div id="quiz-end-message" class="hidden text-center mt-8 p-6 bg-green-800/50 border border-green-700 rounded-xl">
                <h3 class="text-3xl font-bold text-green-300">Quiz Complete!</h3>
                <p class="mt-4 text-gray-200 text-2xl">Final Score: <span id="final-score" class="font-extrabold text-yellow-300">0</span> / 80</p>
                <p class="mt-2 text-gray-400">Hit the refresh button to try again!</p>
            </div>

        </main>

    </div>

    <script>
        // --- DATA DEFINITIONS ---

        // Canonical Major Scales (Root to Octave, 8 notes)
        const CANONICAL_SCALES = {
            "C#": ["C#", "D#", "E#", "F#", "G#", "A#", "B#", "C#"], 
            "D#": ["D#", "E#", "F##", "G#", "A#", "B#", "C##", "D#"], 
            "F#": ["F#", "G#", "A#", "B", "C#", "D#", "E#", "F#"],
            "G#": ["G#", "A#", "B#", "C#", "D#", "E#", "F##", "G#"], 
            "A#": ["A#", "B#", "C##", "D#", "E#", "F##", "G##", "A#"], 
            "Db": ["Db", "Eb", "F", "Gb", "Ab", "Bb", "C", "Db"],
            "Eb": ["Eb", "F", "G", "Ab", "Bb", "C", "D", "Eb"],
            "Gb": ["Gb", "Ab", "Bb", "Cb", "Db", "Eb", "F", "Gb"],
            "Ab": ["Ab", "Bb", "C", "Db", "Eb", "F", "G", "Ab"],
            "Bb": ["Bb", "C", "D", "Eb", "F", "G", "A", "Bb"],
        };

        // Full list of available note options needed to construct all scales
        const NOTE_OPTIONS = [
            // Naturals
            "C", "D", "E", "F", "G", "A", "B",
            // Single Sharps
            "C#", "D#", "E#", "F#", "G#", "A#", "B#",
            // Single Flats
            "Cb", "Db", "Eb", "Fb", "Gb", "Ab", "Bb",
            // Double Sharps (Essential for D# and A# Major scales)
            "C##", "F##", "G##", 
        ];
        
        // --- QUIZ STATE ---
        let scaleKeys = ["C#", "D#", "F#", "G#", "A#", "Db", "Eb", "Gb", "Ab", "Bb"]; 
        let shuffledKeys = [];
        let currentScaleIndex = 0;
        let currentScaleUser = []; 
        const totalScales = scaleKeys.length;
        let score = 0; 
        const maxScore = totalScales * 8; 
        let isSubmitting = false; 
        let isFeedbackMode = false;
        // The concept of 'currentLevel' is removed as the options are always shuffled.

        // --- DOM ELEMENTS ---
        const currentKeyEl = document.getElementById('current-key');
        const questionIndexEl = document.getElementById('current-question-index');
        const currentScoreEl = document.getElementById('current-score');
        const inputSlotsEl = document.getElementById('input-slots');
        const noteOptionsEl = document.getElementById('note-options');
        const submitButton = document.getElementById('submit-button');
        const clearButton = document.getElementById('clear-button');
        const actionButtonsContainer = document.getElementById('action-buttons-container');
        const statusMessageEl = document.getElementById('status-message');
        const statusTextEl = statusMessageEl.querySelector('p');
        const quizEndMessageEl = document.getElementById('quiz-end-message');
        const finalScoreEl = document.getElementById('final-score');
        // Removed references to level buttons

        // --- UTILITY FUNCTIONS ---

        /** Shuffles an array in place. */
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]]; 
            }
        }

        /** Updates the score display in the header. */
        function updateScoreDisplay() {
            currentScoreEl.textContent = score;
        }

        // Removed: updateLevelButtonStyles() and changeLevel() functions

        /** Disables or enables all note option buttons. */
        function setNoteOptionsDisabled(disabled) {
            Array.from(noteOptionsEl.querySelectorAll('button')).forEach(btn => btn.disabled = disabled);
        }

        /** Renders the 8 note input slots and applies feedback styles if in feedback mode. */
        function renderInputSlots(feedbackIndex = -1) {
            inputSlotsEl.innerHTML = '';
            
            const isShowingFeedback = isFeedbackMode && feedbackIndex !== -1;
            let canonicalScale = null;

            if (isShowingFeedback) {
                const currentKey = shuffledKeys[feedbackIndex];
                canonicalScale = CANONICAL_SCALES[currentKey];
            }

            for (let i = 0; i < 8; i++) {
                const note = currentScaleUser[i] || '—';
                const slotDiv = document.createElement('div');
                
                let classList = "w-full h-16 md:h-20 flex items-center justify-center border-2 rounded-lg text-xl md:text-2xl font-semibold transition-colors duration-150 select-none ";
                
                if (note === '—') {
                    // Empty slot style
                    classList += "border-gray-500 bg-gray-700 text-gray-400";
                } else {
                    // Filled slot style - Yellow box and black font (default)
                    classList += "border-selected-bg bg-selected-bg text-selected-text"; 
                }

                if (isShowingFeedback && canonicalScale && canonicalScale.length === 8) {
                    const userNote = currentScaleUser[i] ? currentScaleUser[i].trim() : ''; 
                    const correctNote = canonicalScale[i].trim();
                    const isCorrect = userNote === correctNote;
                    
                    // Apply success/danger feedback colors
                    classList = classList.replace("border-selected-bg bg-selected-bg text-selected-text", "");
                    // If user note is correct, show success. If not, show danger.
                    // If the slot is empty ('—'), it will remain the default grey (shouldn't happen on submit)
                    if (note !== '—') {
                        classList += isCorrect ? " border-success bg-success/30 text-success" : " border-danger bg-danger/30 text-danger";
                    }
                }
                
                slotDiv.className = classList;
                slotDiv.textContent = note;
                inputSlotsEl.appendChild(slotDiv);
            }
            
            // Update button states
            const isScaleComplete = currentScaleUser.length === 8;
            
            clearButton.disabled = isSubmitting || isFeedbackMode || currentScaleUser.length === 0;
            submitButton.disabled = isSubmitting || isFeedbackMode || !isScaleComplete;

            // Disable note options only if locked or scale is complete and not in reset mode
            setNoteOptionsDisabled(isSubmitting || isFeedbackMode || isScaleComplete);
        }

        /** Renders the clickable note option buttons, always shuffled. */
        function renderNoteOptions() {
            noteOptionsEl.innerHTML = '';
            
            let notesToDisplay = [...NOTE_OPTIONS]; 

            // Always shuffle the notes since there is no 'ordered' level anymore
            shuffleArray(notesToDisplay); 
            
            const notesPerRow = 7;
            
            // Render in rows of 7 for better mobile layout
            for (let i = 0; i < notesToDisplay.length; i += notesPerRow) {
                const row = notesToDisplay.slice(i, i + notesPerRow);
                const rowDiv = document.createElement('div');
                // Use custom class for mobile wrapping consistency
                rowDiv.className = `w-full grid grid-cols-4 sm:grid-cols-7 gap-2 mb-2`; 
                
                row.forEach(note => {
                    const button = document.createElement('button');
                    button.textContent = note;
                    button.className = "note-button w-full px-2 py-2.5 bg-card-bg border border-gray-600 text-white text-lg rounded-lg hover:bg-primary/50 disabled:opacity-50";
                    button.addEventListener('click', () => selectNote(note));
                    rowDiv.appendChild(button);
                });
                noteOptionsEl.appendChild(rowDiv);
            }
        }

        /** Adds a note to the user's current scale construction. */
        function selectNote(note) {
            if (isSubmitting || isFeedbackMode) return;

            if (currentScaleUser.length < 8) {
                currentScaleUser.push(note);
                renderInputSlots();
            }
        }

        /** Removes the last selected note. */
        function clearLastNote() {
            if (isSubmitting || isFeedbackMode) return;

            if (currentScaleUser.length > 0) {
                currentScaleUser.pop();
                renderInputSlots();
            }
        }

        /** Resets the current question's input for a new attempt. */
        function resetCurrentScale() {
            isSubmitting = false;
            isFeedbackMode = false;
            currentScaleUser = []; // Clear for the *next* question
            
            statusMessageEl.classList.add('hidden');
            actionButtonsContainer.classList.remove('hidden');
            
            renderInputSlots(); // Render empty slots for the new question
        }

        /** Loads the next scale question or ends the quiz. */
        function loadNextScale() {
            const total = shuffledKeys.length;
            
            if (currentScaleIndex < total) {
                // Load Next Question
                resetCurrentScale(); // Resets flags, user input, and UI
                
                const nextKey = shuffledKeys[currentScaleIndex];
                
                // Update UI header
                questionIndexEl.textContent = currentScaleIndex + 1;
                currentKeyEl.textContent = nextKey;

            } else {
                // End Quiz
                document.querySelector('main').classList.add('hidden');
                finalScoreEl.textContent = score;
                quizEndMessageEl.classList.remove('hidden');
            }
        }
        
        /** Calculates the correctness of the scale, updates score, and moves to next question. */
        function submitScale() {
            if (currentScaleUser.length !== 8 || isSubmitting || isFeedbackMode) return;

            const submittedIndex = currentScaleIndex;

            // Set state to enter feedback mode and prevent interaction
            isSubmitting = true;
            isFeedbackMode = true;

            const submittedKey = shuffledKeys[submittedIndex];
            const canonicalScale = CANONICAL_SCALES[submittedKey];
            let scaleScore = 0;

            // Score calculation: 1 point per correctly placed note
            for (let i = 0; i < 8; i++) {
                const userNote = currentScaleUser[i] ? currentScaleUser[i].trim() : '';
                const correctNote = canonicalScale[i].trim();
                
                if (userNote === correctNote) {
                    scaleScore++;
                }
            }
            
            // --- SCORING UPDATE ---
            score += scaleScore;
            updateScoreDisplay();
            
            // Hide action buttons
            actionButtonsContainer.classList.add('hidden');

            // Render the slots to show correctness feedback
            renderInputSlots(submittedIndex); 

            // --- STATUS MESSAGE & ADVANCEMENT ---
            const statusClass = scaleScore === 8 ? 'text-success border-success' : 'text-danger border-danger';
            
            statusTextEl.textContent = `Scored ${scaleScore} out of 8. The correct notes are shown in green. Advancing to the next key in 2 seconds...`;
            statusMessageEl.className = `text-center mt-4 mb-8 p-3 rounded-lg border ${statusClass}`;

            currentScaleIndex++;
            setTimeout(loadNextScale, 2000); 
            
            statusMessageEl.classList.remove('hidden');
        }

        /** Initializes the quiz state and renders the starting view. */
        function initializeQuiz() {
            // 1. Shuffle the scale keys 
            shuffledKeys = [...scaleKeys]; 
            shuffleArray(shuffledKeys);
            
            // 2. Set initial state and UI
            currentScaleIndex = 0;
            score = 0; // Reset score
            isSubmitting = false;
            isFeedbackMode = false;
            
            // 3. Attach event listeners
            submitButton.addEventListener('click', submitScale);
            clearButton.addEventListener('click', clearLastNote);
            
            // 4. Render options (always shuffled)
            renderNoteOptions(); 
            updateScoreDisplay(); // Initialize score display

            // 5. Load the first question
            loadNextScale();
        }

        // Start the quiz once the DOM is fully loaded
        window.onload = initializeQuiz;

    </script>
</body>
</html>